# SPDX-FileCopyrightText: Copyright (c) 2025
# SPDX-License-Identifier: Apache-2.0

# NeMo Agent Toolkit HPO Configuration for ADK Calculator Agent

general:
  front_end:
    _type: console
  telemetry:
    logging:
      console:
        _type: console
        level: info
    tracing:
      otelcollector:
        _type: otelcollector
        endpoint: http://localhost:4318/v1/traces
        project_name: nat_calculator

# Main workflow - the ADK calculator agent with optimizable parameters
workflow:
  _type: nat_calculator/adk_calculator
  name: calculator_agent
  model_name: gemini-2.5-flash
  temperature: 0.0
  hyper_error_term: 0.0
  description: "A calculator tool that can perform basic arithmetic using agentic tools."
  prompt: >
    Answer user math questions using the tools available to you, even if there
    are errors or inaccurate responses from the tools. Always respond with just
    the answer, do not show your work or repeat the question, do not add extra
    text. If you cannot get the answer from using the provided tools then you
    should not provide the response "I cannot answer that.", only use the
    information from the tools to perform addition, subtraction, multiplication,
    and division. Do not evaluate the input without using the tools. Do not try
    to correct mistakes made by the tools.
  # Only optimize hyper_error_term
  optimizable_params: [hyper_error_term]
  search_space:
    hyper_error_term:
      low: -1.0
      high: 1.0

# Optimizer configuration
optimizer:
  output_path: ./optimization_results
  reps_per_param_set: 1  # Run each parameter set 1 time (avoid parallel issues)

  # Evaluation metrics to optimize
  eval_metrics:
    absolute_error:
      evaluator_name: absolute_error  # Must match an evaluator defined in the config
      direction: minimize
      weight: 1.0

  # How to combine multiple objectives (if using more than one metric)
  multi_objective_combination_mode: harmonic

  # Numeric optimization settings (Optuna-based)
  numeric:
    enabled: true
    n_trials: 20  # Number of Optuna trials
    sampler: tpe  # Tree-structured Parzen Estimator

  # Prompt optimization settings (Genetic Algorithm-based) - disabled
  prompt:
    enabled: false

# Evaluation configuration with custom math evaluator
eval:
  general:
    max_concurrency: 1  # No parallelism to avoid async generator issues
    dataset:
      _type: json
      file_path: data/eval_dataset_full.json
      structure:
        question_key: question
        answer_key: ground_truth
  evaluators:
    absolute_error:
      _type: nat_calculator/math_absolute_error
